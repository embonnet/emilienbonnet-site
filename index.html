<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portfolio personnel d’Emilien Bonnet. Projets, expériences professionnelles, passions et références, présentés sous forme de cartes interactives." />
    <title>Emilien Bonnet</title>

    <!-- Google Fonts / Material Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="image" href="assets/images/ui/background.jpg" fetchpriority="high">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/main.min.css">
</head>
<body>

    <!-- introduction -->
    <div class="intro-overlay">
        <div class="intro-content">
            <img src="assets/images/profil.jpg" alt="Photo de profil" class="intro-avatar">

            <p class="intro-text">
                Bienvenue sur mon espace personnel.<br>
                Cette page rassemble, sous forme de cartes interactives,
                les projets, passions et expériences qui me définissent.
            </p>

            <button class="intro-btn">Découvrir</button>
        </div>
    </div>

    <!-- loader -->
    <div class="loader">
        <div class="loader-content">
            <div class="spinner"></div>
            <div class="loader-text">Chargement…</div>
        </div>
    </div>

    <div class="page-content">
        <header class="main-header">
            <div class="logo-header"><img src="assets/images/profil.jpg" alt="Photo de profil" class="header-avatar"></div>
            <div class="content-infos-header">
                <div class="header-content">
                    <div class="logo">
                        <span class="title">Emilien Bonnet</span>
                    </div>

                    <!-- switch pro/perso -->
                    <label class="scope-toggle">
                        <input id="scopeToggle"
                            type="checkbox"
                            role="switch"
                            aria-label="Basculer entre les catégories Perso et Pro"
                            aria-checked="false" />
                        <span class="slider round"></span>

                        <span class="select-left">Pro</span>
                        <span class="select-right">Perso</span>
                    </label>

                    <div class="header-icons">
                        <!-- LinkedIn -->
                        <a href="https://www.linkedin.com/in/emilien-bonnet-5b13a6b6/"
                        target="_blank"
                        class="header-icon social-icon">
                            <img src="assets/icons/linkedin.svg"
                                alt="LinkedIn"
                                class="social-icon" 
                            />
                        </a>

                        <!-- CV (modale) -->
                        <a href="#"
                        class="header-icon"
                        aria-label="Ouvrir le CV"
                        id="cv-open">
                            <i class="material-icons">contact_page</i>
                        </a>

                    </div>
                </div>

                <div class="filters">
                    <!-- filtres générés dynamiquement -->
                </div>
            </div>
        </header>

        <div class="overlay"></div>

        <div class="wrapper" id="main-content" role="main">
            <!-- Les cartes seront generees ici via JavaScript -->
        </div>
    </div>

    <!--<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>-->
    <script>
        const wrapper = document.querySelector('#main-content');

        // melange aléatoire à chaque chargement (identique à ton code)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Chargement des cartes depuis le JSON
        fetch('data/cards.json', { cache: 'no-store' })
            .then((res) => {
                if (!res.ok) throw new Error(`Impossible de charger data/cards.json (HTTP ${res.status})`);
                return res.json();
            })
            .then((cardsOrder) => {
                if (!Array.isArray(cardsOrder)) throw new Error('cards.json doit contenir un tableau');

                shuffleArray(cardsOrder);

                cardsOrder.forEach((data, i) => {
                    const card = document.createElement('div');
                    card.className = `card card-${i}`;

                    // recuperer tous les couples type / icon
                    const meta = [
                        { type: data.type, icon: data.icon },
                        { type: data.type2, icon: data.icon2 },
                        { type: data.type3, icon: data.icon3 }
                    ].filter(m => m.type && m.icon);

                    // stocker les types pour le filtrage
                    card.dataset.types = meta.map(m => m.type).join(',');

                    // stocker le texte contextuel
                    if (data.text) {
                        card.dataset.text = data.text;
                    }

                    // lazy load (conservé)
                    card.dataset.bg = data.bg;

                    // generer les pastilles correctement
                    card.innerHTML = `
                        <div class="glare-container">
                            <div class="container-metadata">
                            ${meta.map(m => `
                                <div class="metadata ${m.type}">
                                <i class="material-icons">${m.icon}</i>
                                </div>
                            `).join('')}
                            </div>
                            <div class="glare"></div>
                        </div>
                        `;

                    wrapper.appendChild(card);
                });

                if (typeof window.bootstrapAfterCards === 'function') {
                    window.bootstrapAfterCards();
                }
            })
            .catch((err) => {
                console.error('[cards] Erreur chargement JSON:', err);

                // Optionnel : message visible si besoin
                // wrapper.innerHTML = '<p style="color:white;padding:20px;">Erreur de chargement des cartes.</p>';
            });
    </script>

    <!-- appel script -->
    <script type="module" src="js/main.js" defer></script>

    <!-- custom cursor 
    <div class="cursor-dot"></div>
    <div class="cursor-outline"></div> -->

    <!-- CV MODAL -->
    <div class="cv-overlay" id="cv-overlay" aria-hidden="true"></div>

    <div class="cv-modal" id="cv-modal" role="dialog" aria-modal="true" aria-label="CV">
        <button class="cv-close" id="cv-close" aria-label="Fermer">
            <i class="material-icons">close</i>
        </button>

        <div class="cv-frame-wrap">
            <iframe class="cv-frame"
                    src="assets/images/CV2025EBT.pdf"
                    title="CV"
                    loading="lazy">
            </iframe>
        </div>
    </div>

    <footer class="main-footer">
        <div class="footer-content">
            <nav class="footer-links" aria-label="Liens légaux">
            <a href="legal/mentions-legales.html">Mentions légales</a>
            <span class="footer-separator">•</span>
            <a href="legal/politique-confidentialite.html">Politique de confidentialité</a>
            </nav>

            <div class="footer-copy">
            © <span id="footer-year"></span> Emilien Bonnet
            </div>
        </div>
    </footer>

    <script>
    // année auto (propre et sans dépendance)
    document.getElementById("footer-year").textContent = new Date().getFullYear();
    </script>

</body>
</html>
